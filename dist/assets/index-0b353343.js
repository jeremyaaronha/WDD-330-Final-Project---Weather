(function(){const p=document.createElement("link").relList;if(p&&p.supports&&p.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))d(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function w(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function d(n){if(n.ep)return;n.ep=!0;const s=w(n);fetch(n.href,s)}})();console.log("Weather App is running!");document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("city-name"),p=document.getElementById("temperature"),w=document.getElementById("forecast-container"),d=document.querySelector(".search-container input"),n=document.querySelector(".suggestions-container"),s=document.getElementById("unit-toggle"),a=document.getElementById("login-form"),c=document.getElementById("register-form"),x=document.getElementById("login-button"),k=document.getElementById("register-button"),B=document.getElementById("login-close"),M=document.getElementById("register-close");let m=!0;const E="0066e3596484e7ae608d23fe3959f109",D=async(t,e)=>{try{const o=m?"metric":"imperial",i=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${t}&lon=${e}&units=${o}&appid=${E}`);if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const r=await i.json(),g=r.name,y=r.sys.country,H=r.main.temp,N=r.weather[0].icon,U=r.weather[0].description;u.textContent=`Temperature in ${g}, ${y}`,p.innerHTML=`
            
            <img src="http://openweathermap.org/img/wn/${N}@2x.png" alt="${U}">${H} °${m?"C":"F"}
        `;const L=await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${t}&lon=${e}&units=${o}&appid=${E}`);if(!L.ok)throw new Error(`HTTP error! status: ${L.status}`);const $=(await L.json()).list,T=$.reduce((l,f)=>{const h=new Date(f.dt_txt).toDateString();return l[h]||(l[h]=[]),l[h].push(f.main.temp_min,f.main.temp_max),l},{}),q=Object.keys(T).slice(0,5),F=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],J=["January","February","March","April","May","June","July","August","September","October","November","December"];w.innerHTML="",q.forEach(l=>{const f=T[l],h=Math.min(...f),R=Math.max(...f),C=new Date(l),j=F[C.getUTCDay()],A=J[C.getUTCMonth()],W=`${j}, ${A} ${C.getUTCDate()}`,I=document.createElement("div");I.classList.add("forecast-day"),I.innerHTML=`
                    <p>${W}</p>
                    <img src="http://openweathermap.org/img/wn/${$.find(S=>new Date(S.dt_txt).toDateString()===l).weather[0].icon}@2x.png" alt="${$.find(S=>new Date(S.dt_txt).toDateString()===l).weather[0].description}">
                    <p>Min: ${h} °${m?"C":"F"}</p>
                    <p>Max: ${R} °${m?"C":"F"}</p>
                `,w.appendChild(I)})}catch(o){console.error("Error fetching the weather data:",o),u.textContent="Error retrieving weather data.",p.textContent=""}},v=async t=>{try{const e=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&appid=${E}`);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const o=await e.json(),{lat:i,lon:r}=o.coord;await D(i,r)}catch(e){console.error("Error fetching the weather data:",e),u.textContent="Error retrieving weather data.",p.textContent=""}},O=async t=>{try{const e=await fetch(`https://wft-geo-db.p.rapidapi.com/v1/geo/cities?namePrefix=${t}`,{method:"GET",headers:{"X-RapidAPI-Key":"e910cc3969msh71ab17d4f77c665p1b6bfajsn5ecd6ff742cf","X-RapidAPI-Host":"wft-geo-db.p.rapidapi.com"}});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return(await e.json()).data.map(i=>`${i.city}, ${i.country}`)}catch(e){return console.error("Error fetching city suggestions:",e),[]}},P=t=>{n.innerHTML="",t.forEach(e=>{const o=document.createElement("div");o.classList.add("suggestion"),o.textContent=e,o.addEventListener("click",()=>{d.value=e,v(e),n.innerHTML=""}),n.appendChild(o)})};navigator.geolocation?navigator.geolocation.getCurrentPosition(async t=>{const{latitude:e,longitude:o}=t.coords;await D(e,o)},()=>{u.textContent="Unable to retrieve your location."}):u.textContent="Geolocation is not supported by this browser.",d.addEventListener("input",async()=>{const t=d.value.trim();if(t){const e=await O(t);P(e)}else n.innerHTML=""}),d.addEventListener("keypress",t=>{if(t.key==="Enter"){const e=d.value.trim();e&&(v(e),n.innerHTML="")}}),s.addEventListener("click",()=>{m=!m,s.textContent=`Switch to °${m?"F":"C"}`;const t=u.textContent.split(" ")[2];t&&v(t)}),x.addEventListener("click",()=>{a.style.display="block",c.style.display="none"}),k.addEventListener("click",()=>{c.style.display="block",a.style.display="none"}),document.getElementById("show-login").addEventListener("click",t=>{t.preventDefault(),a.style.display="block",c.style.display="none"}),document.getElementById("show-register").addEventListener("click",t=>{t.preventDefault(),c.style.display="block",a.style.display="none"}),B.addEventListener("click",()=>{a.style.display="none"}),M.addEventListener("click",()=>{c.style.display="none"}),c.addEventListener("submit",t=>{t.preventDefault();const e=c.querySelector('input[placeholder="Username"]').value,o=c.querySelector('input[placeholder="Email"]').value,i=c.querySelector('input[placeholder="Password"]').value,r=JSON.parse(localStorage.getItem("users"))||[];if(r.some(y=>y.email===o||y.username===e))alert("Username or email is already taken. Please choose another.");else{const y={username:e,email:o,password:i};r.push(y),localStorage.setItem("users",JSON.stringify(r)),alert("Registration successful! You can now log in."),c.style.display="none",a.style.display="block"}});const b=t=>{const e=document.querySelector(".login-register");e.innerHTML=`Bienvenido, ${t}! <a href="#" id="logout">Cerrar sesión</a>`,document.getElementById("logout").addEventListener("click",i=>{i.preventDefault(),localStorage.removeItem("loggedInUser"),location.reload()})};a.addEventListener("submit",t=>{t.preventDefault();const e=a.querySelector('input[type="text"]').value,o=a.querySelector('input[type="password"]').value,r=(JSON.parse(localStorage.getItem("users"))||[]).find(g=>(g.email===e||g.username===e)&&g.password===o);r?(alert(`Welcome, ${r.username}!`),localStorage.setItem("loggedInUser",JSON.stringify(r)),a.style.display="none",b(r.username)):alert("Invalid email/username or password. Please try again.")}),document.addEventListener("DOMContentLoaded",()=>{const t=JSON.parse(localStorage.getItem("loggedInUser"));t&&b(t.username)})});
